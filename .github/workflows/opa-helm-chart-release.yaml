name: opa_helm_chart_release
on:
  push:
    paths-ignore:
      - ".github/workflows/website.yaml"
      - "docs/**"
      - "logo/**"
      - "examples/**"
      - "**.md"
  pull_request:
    paths-ignore:
      - ".github/workflows/website.yaml"
      - "docs/**"
      - "logo/**"
      - "examples/**"
      - "**.md"

jobs:
  tagged-release:
    name: "Tagged Release"
    runs-on: "ubuntu-latest"
    if: startsWith(github.ref, 'refs/tags/v') && github.repository == 'open-policy-agent/kube-mgmt'
    timeout-minutes: 30
    steps:
      - name: Check out code
        uses: actions/checkout@v2

      - name: Publish Helm chart
        uses: stefanprodan/helm-gh-pages@v1.2.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          charts_dir: charts
          target_dir: charts
          linting: off
